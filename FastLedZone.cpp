// ****************************************************************************
//  Filename: 
//
//  Author: JP Faucher (jonpaul.faucher@gmail.com)
// ****************************************************************************
//  Details:
//
//
//  Notes:
//
// ****************************************************************************
#include "FastLedZone.h"
#include "FastLedEffect.h"

// ****************************************************************************
// Function:
// ****************************************************************************
// Arguments:
//
// ****************************************************************************
// Description:
//
// ****************************************************************************
// Notes:
//
// ****************************************************************************
FastLedZone::FastLedZone(
            char*       aZoneName, 
            int         aStartIndex, 
            int         aEndIndex, 
            const char* aEffectName,
            CRGB        aColor=CRGB(50,50,50),
            uint8_t     aBrightness=50) : 
    mZoneName(aZoneName),
    mStartIndex(aStartIndex), 
    mEndIndex(aEndIndex),
    mStripLeds(NULL),
    mStripCount(0),
    mColor(aColor),
    mBrightness(aBrightness),
    mEffectSolid(this),
    mEffectTwinkle(this),
    mEffectCylon(this),
    mEffectIndexer(this),
    mEffectList(),
    mCurrentEffect(NULL)
{
  mEffectList.push_back(&mEffectSolid);
  mEffectList.push_back(&mEffectTwinkle);
  mEffectList.push_back(&mEffectCylon);
  mEffectList.push_back(&mEffectIndexer);  

  set_effect(aEffectName);
}

// ****************************************************************************
// Function:
// ****************************************************************************
// Arguments:
//
// ****************************************************************************
// Description:
//
// ****************************************************************************
// Notes:
//
// ****************************************************************************
void FastLedZone::set_led_strip(CRGB *aStripLeds, int aStripCount)         
{ 
  mStripLeds = aStripLeds; 
  mStripCount = aStripCount; 
}

// ****************************************************************************
// Function:
// ****************************************************************************
// Arguments:
//
// ****************************************************************************
// Description:
//
// ****************************************************************************
// Notes:
//
// ****************************************************************************
bool FastLedZone::set_effect(const char* aEffectName) 
{ 
  Iterator<FastLedEffect*> lIter = mEffectList.begin();

  while(lIter != NULL)
  {
    if(0 == strcmp(aEffectName, (*lIter)->get_effect_name()))
    {
      Serial.print(F("Found Effect: "));
      Serial.println(aEffectName);

      mCurrentEffect = *lIter;
      mCurrentEffect->reset();
      return true;
    }

    lIter++;
  }

  Serial.print(F("Found NOT Effect: "));
  Serial.println(aEffectName);

  return false;
}

// ****************************************************************************
// Function:
// ****************************************************************************
// Arguments:
//
// ****************************************************************************
// Description:
//
// ****************************************************************************
// Notes:
//
// ****************************************************************************
FastLedEffect* FastLedZone::get_effect()
{
  return mCurrentEffect;   
}

// ****************************************************************************
// Function:
// ****************************************************************************
// Arguments:
//
// ****************************************************************************
// Description:
//
// ****************************************************************************
// Notes:
//
// ****************************************************************************
void FastLedZone::loop()
{
  mCurrentEffect->loop();
}

// ****************************************************************************
// Function:
// ****************************************************************************
// Arguments:
//
// ****************************************************************************
// Description:
//
// ****************************************************************************
// Notes:
//
// ****************************************************************************
void FastLedZone::enable_zone()
{
  if(NULL != mCurrentEffect)
    mCurrentEffect->set_enabled(true);
}

// ****************************************************************************
// Function:
// ****************************************************************************
// Arguments:
//
// ****************************************************************************
// Description:
//
// ****************************************************************************
// Notes:
//
// ****************************************************************************
void FastLedZone::disable_zone()
{
  if(NULL != mCurrentEffect)
    mCurrentEffect->set_enabled(false);
}

// ****************************************************************************
// Function:
// ****************************************************************************
// Arguments:
//
// ****************************************************************************
// Description:
//
// ****************************************************************************
// Notes:
//
// ****************************************************************************
bool FastLedZone::get_enabled()
{
  if(NULL != mCurrentEffect)
    return mCurrentEffect->get_enabled();

  return false;
}